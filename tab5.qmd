---
title: "AP Scholar Awards"
---

This map shows the distribution of AP Scholar awards in the Untied States for the year 2020.

You can hover the cursor over the states on the plot to display extra information.

```{r}
#| echo: false
#| message: false
#| warning: false

library(readxl)
library(tidyverse)
library(gganimate)
library(gifski)
library(dplyr)
library(magick)
library(ggthemes)
library(ggplot2)
library(plotly)

ap_scholars <- read_xlsx(path = "data/ap-scholar-data-2020.xlsx")

ap_scholars <- ap_scholars |>
  arrange(State) |>
    replace_na(list(State = 'missing', `Grade Level` = 'none')) 

ap_scholars <- ap_scholars[278:328,]

ap_scholars <- tibble::rowid_to_column(ap_scholars, "ID")

colnames(ap_scholars) <- c("ID", "State", "Grade Level", "Total Scholar Awards", "Scholar", "Honor", "Distinction", "National", "Canadian", "International", "Bermuda", "CapstoneDip", "CapstoneCert")

ap_scholars <- ap_scholars |>
  mutate(State = ID,
         Other = Canadian + International + Bermuda + CapstoneDip + CapstoneCert) |>
    select(State, `Total Scholar Awards`, Scholar, Honor, Distinction, National, Other)

ap_scholars$State <- as.character(ap_scholars$State)

state_names <- c("AK", "AL", "AR", "AZ", "CA", "CO", "CT",
                 "DC", "DE", "FL", "GA", "HI", "IA", "ID",
                 "IL", "IN", "KS", "KY", "LA", "MA", "MD",
                 "ME", "MI", "MN", "MO", "MS", "MT", "NC",
                 "ND", "NE", "NH", "NJ", "NM", "NV", "NY",
                 "OH", "OK", "OR", "PA", "RI", "SC", "SD",
                 "TN", "TX", "UT", "VA", "VT", "WA", "WI",
                 "WV", "WY")

ap_scholars$State <- state_names

plot_ly(type = "choropleth",
        locations = ap_scholars$State,
        locationmode = "USA-states",
        z = ap_scholars$`Total Scholar Awards`,
        colors = 'YlOrBr',
        hoverinfo = "text",
        hovertext = paste("Total Scholar Awards:", ap_scholars$`Total Scholar Awards`,
                          "\nScholar Awards:", ap_scholars$Scholar,
                          "\nScholor with Honor Awards:", ap_scholars$Honor,
                          "\nScholor with Distinction Awards:", ap_scholars$Distinction,
                          "\nNational AP Scholar Awards:", ap_scholars$National,
                          "\nOther Scholar Awards:", ap_scholars$Other)) |>
  layout(geo = list(scope = "usa"),
         title = "AP Scholar Awards by State (2020)",
         annotations = list(yref = 'paper', xref = "paper", y = 1.025, x = 1.16,
                            text = "Total Scholar Awards", showarrow = F)) |>
    add_annotations(yref = 'paper', xref = "paper", y = 0, x = 1.15,
                    text = "College Board: AP Scholar Counts by State 2020", showarrow = F)
```